#include <iostream> // Libreria estandar para usar cin y cout
#include <cstdlib>  // Libreria para usar comandos del sistema como limpiar pantalla
#include <string>   // Libreria para poder usar variables de texto (string)
#include <iomanip>  // Libreria para dar formato y alinear las tablas (setw)
#include <limits>   // Libreria necesaria para limpiar el buffer de entrada

using namespace std; // Nos ahorra escribir std:: antes de cada comando

// Estructura que agrupa los datos de cada articulo
struct Producto {
    int id;           // Codigo unico del producto
    string nombre;    // Nombre del articulo
    float precio;     // Precio con decimales
    int cantidad;     // Stock disponible
};

// Prototipos: Avisamos al compilador que estas funciones existen
void limpiarPantalla();
void baseDeDatos(Producto inventario[]);
void mostrarMenu();
void mostrarInventario(Producto inventario[], int n);
void ordenarProductos(Producto inventario[], int n);
void gestionarProducto(Producto inventario[], int n); 
void realizarVenta(Producto *p);       
void registrarEntrada(Producto *p);    
void corregirStock(Producto *p);       
void cambiarPrecio(Producto *p); 

int main() {
    const int N = 15; // Definimos el tamano maximo del inventario (constante)
    Producto inventario[N]; // Creamos el arreglo de estructuras
    int opcion; // Variable para guardar la eleccion del menu principal

    // Llamamos a la funcion que carga los datos iniciales
    baseDeDatos(inventario);

    bool sistemaActivo = true; // Variable bandera para controlar el ciclo del programa

    // Ciclo principal: se repite mientras sistemaActivo sea verdadero
    while (sistemaActivo) {
        limpiarPantalla(); // Limpiamos la consola para que se vea ordenado
        mostrarMenu();     // Mostramos las opciones
        cout << "Elige una opcion: ";
        cin >> opcion;     // Leemos la opcion del usuario

        // Evaluamos la opcion elegida
        switch (opcion) {
            case 1:
                mostrarInventario(inventario, N);
                break;
            case 2:
                gestionarProducto(inventario, N); // Entramos al menu de acciones
                break;
            case 3:
                ordenarProductos(inventario, N);
                break;
            case 4:
                cout << "Cerrando sistema..." << endl;
                sistemaActivo = false; // Cambiamos a falso para salir del while
                break;
            default:
                cout << "Opcion no valida." << endl;
                cout << "Presiona Enter...";
                cin.ignore(); cin.get(); // Pausa simple
        }
    }

    return 0; // Fin del programa
}

// Funcion para borrar lo que hay en la consola
void limpiarPantalla() {
    #ifdef _WIN32
        system("cls"); // Comando para Windows
    #else
        system("clear"); // Comando para Linux/Mac
    #endif
}

// Funcion para llenar el arreglo con datos de prueba
void baseDeDatos(Producto inventario[]) {
    // Asignamos valores directos a cada posicion del arreglo
    inventario[0] = {10, "Borrador", 5.00, 50};
    inventario[1] = {20, "Lapiz", 8.50, 100};
    inventario[2] = {30, "Pluma", 12.00, 80};
    inventario[3] = {40, "Libreta", 45.00, 30};
    inventario[4] = {50, "Calculadora", 150.00, 10};
    inventario[5] = {60, "Regla", 15.00, 40};
    inventario[6] = {70, "Tijera", 25.00, 25};
    inventario[7] = {80, "Marcatextos", 18.00, 60};
    inventario[8] = {90, "Grapadora", 65.00, 15};
    inventario[9] = {100, "Plumon", 22.00, 70};
    inventario[10] = {110, "Clip", 1.50, 500};
    inventario[11] = {120, "Hojas", 0.50, 1000};
    inventario[12] = {130, "Carpetas", 15.00, 40};
    inventario[13] = {140, "Sacapuntas", 5.00, 55};
    inventario[14] = {150, "Pegamento", 12.50, 35};
}

void mostrarMenu() {
    cout << "PAPELERIA EL PAPELITO FELIZ" << endl;
    cout << "1. Ver todo el inventario" << endl;
    cout << "2. Buscar (Vender / Surtir / Editar)" << endl;
    cout << "3. Ordenar lista" << endl;
    cout << "4. Salir" << endl;
}

// Recorre el arreglo e imprime los datos en forma de tabla
void mostrarInventario(Producto inventario[], int n) {
    limpiarPantalla();
    
    // setw ayuda a alinear las columnas dejando espacios fijos
    cout << left << setw(5) << "ID" 
         << setw(15) << "Nombre" 
         << setw(10) << "Precio" 
         << setw(10) << "Stock" << endl;
    
    // Ciclo for para recorrer todos los productos
    for(int i = 0; i < n; i++) {
        cout << left << setw(5) << inventario[i].id 
             << setw(15) << inventario[i].nombre 
             // fixed y setprecision(2) obligan a mostrar 2 decimales
             << "$" << setw(9) << fixed << setprecision(2) << inventario[i].precio 
             << setw(10) << inventario[i].cantidad << endl;
    }
    
    cout << endl << "Presiona Enter para volver...";
    cin.ignore(); cin.get(); // Esperamos a que el usuario de Enter
}
// Algoritmo de burbuja para ordenar los productos
void ordenarProductos(Producto inventario[], int n) {
    int tipoOrden; // Variable para guardar si ordenamos por precio o cantidad
    Producto temp; // Variable auxiliar para hacer el intercambio temporal

    limpiarPantalla();
    cout << "Ordenar por: 1. Precio  |  2. Cantidad" << endl;
    cin >> tipoOrden;

    // Primer ciclo: controla las pasadas
    for(int i = 0; i < n - 1; i++) {
        // Segundo ciclo: compara elementos adyacentes
        for(int j = 0; j < n - 1; j++) {
            bool intercambio = false; // Bandera para saber si hay que mover cosas

            // Decidimos si intercambiar segun el criterio (Precio o Cantidad)
            if (tipoOrden == 1) {
                if (inventario[j].precio > inventario[j+1].precio) intercambio = true;
            } else if (tipoOrden == 2) {
                if (inventario[j].cantidad > inventario[j+1].cantidad) intercambio = true;
            }

            // Si estan desordenados, hacemos el cambio (swap)
            if (intercambio) {
                temp = inventario[j];          // Guardamos el actual
                inventario[j] = inventario[j+1]; // Movemos el siguiente al actual
                inventario[j+1] = temp;          // Ponemos el guardado en el siguiente
            }
        }
    }
    cout << "Lista ordenada." << endl;
    cout << "Presiona Enter para ver la lista...";
    cin.ignore(); cin.get();
    mostrarInventario(inventario, n); // Mostramos la lista ya ordenada
}

// Funcion para buscar un producto y mostrar sus opciones
void gestionarProducto(Producto inventario[], int n) {
    int idBusqueda; // Variable para almacenar el ID que el usuario busca
    Producto *p = NULL; // Puntero para apuntar al producto encontrado

    limpiarPantalla();
    cout << "INGRESA EL ID DEL PRODUCTO:" << endl;
    cin >> idBusqueda;

    // Busqueda secuencial: revisamos uno por uno
    for(int i = 0; i < n; i++) {
        if (inventario[i].id == idBusqueda) {
            p = &inventario[i]; // Guardamos la direccion de memoria del producto
            break; // Terminamos el ciclo porque ya lo encontramos
        }
    }

    // Si el puntero sigue siendo NULL, no encontramos nada
    if (p == NULL) {
        cout << "Producto no encontrado." << endl;
        cout << "Presiona Enter...";
        cin.ignore(); cin.get();
        return;
    }

    int subOpcion; // Variable para la opcion del submenu
    limpiarPantalla();
    // Usamos -> para acceder a los datos a traves del puntero
    cout << "PRODUCTO: " << p->nombre << endl;
    cout << "Precio: $" << p->precio << " | Stock: " << p->cantidad << endl;
    cout << endl;
    cout << "Que deseas hacer?" << endl;
    cout << "1. Registrar VENTA" << endl;
    cout << "2. Registrar ENTRADA (Surtir)" << endl;
    cout << "3. CORREGIR Stock (Error de dedo)" << endl;
    cout << "4. CAMBIAR PRECIO" << endl; 
    cout << "5. Nada (Regresar)" << endl;
    cin >> subOpcion;

    // Llamamos a la funcion correspondiente enviando el puntero p
    switch(subOpcion) {
        case 1: realizarVenta(p); break;
        case 2: registrarEntrada(p); break;
        case 3: corregirStock(p); break;
        case 4: cambiarPrecio(p); break; 
        case 5: break; 
        default: cout << "Opcion invalida." << endl;
    }
    
    cout << "Presiona Enter para continuar...";
    cin.ignore(); cin.get();
}
